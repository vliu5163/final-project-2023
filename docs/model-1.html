<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 [Model 1] | Final Project Proposal</title>
  <meta name="description" content="Chapter 3 [Model 1] | Final Project Proposal" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 [Model 1] | Final Project Proposal" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 [Model 1] | Final Project Proposal" />
  
  
  

<meta name="author" content="Vivian Liu" />


<meta name="date" content="2023-04-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sources.html"/>
<link rel="next" href="model-2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">FINAL</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Proposal</a></li>
<li class="chapter" data-level="2" data-path="sources.html"><a href="sources.html"><i class="fa fa-check"></i><b>2</b> Sources</a></li>
<li class="chapter" data-level="3" data-path="model-1.html"><a href="model-1.html"><i class="fa fa-check"></i><b>3</b> [Model 1]</a></li>
<li class="chapter" data-level="4" data-path="model-2.html"><a href="model-2.html"><i class="fa fa-check"></i><b>4</b> [Model 2]</a></li>
<li class="chapter" data-level="5" data-path="model-3.html"><a href="model-3.html"><i class="fa fa-check"></i><b>5</b> [Model 3]</a></li>
<li class="chapter" data-level="6" data-path="reflections.html"><a href="reflections.html"><i class="fa fa-check"></i><b>6</b> Reflections</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Final Project Proposal</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-1" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> [Model 1]<a href="model-1.html#model-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="model-1.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(OneR)</span>
<span id="cb1-2"><a href="model-1.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="model-1.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1-4"><a href="model-1.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="model-1.html#cb2-1" aria-hidden="true" tabindex="-1"></a>taxi_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;data/2021_taxi_data_mod.csv&#39;</span>)</span></code></pre></div>
<p>Split into test and train:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="model-1.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5293</span>)</span>
<span id="cb3-2"><a href="model-1.html#cb3-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(taxi_data)</span>
<span id="cb3-3"><a href="model-1.html#cb3-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(n, .<span class="dv">8</span><span class="sc">*</span>n)</span>
<span id="cb3-4"><a href="model-1.html#cb3-4" aria-hidden="true" tabindex="-1"></a>train_dat <span class="ot">&lt;-</span> taxi_data[train, ]</span>
<span id="cb3-5"><a href="model-1.html#cb3-5" aria-hidden="true" tabindex="-1"></a>test_dat <span class="ot">&lt;-</span> taxi_data[<span class="sc">-</span>train, ]</span>
<span id="cb3-6"><a href="model-1.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(train_dat)</span></code></pre></div>
<pre><code>##       X.1        X VendorID   tpep_pickup_datetime  tpep_dropoff_datetime
## 6155 6502 10586561        2 06/15/2021 08:44:23 AM 06/15/2021 08:50:13 AM
## 10     13 30109014        2 12/22/2021 01:38:45 AM 12/22/2021 01:41:03 AM
## 3649 3853 22411638        1 10/16/2021 05:02:12 PM 10/16/2021 05:14:05 PM
## 4464 4715 11680245        2 06/26/2021 07:39:15 PM 06/26/2021 07:57:34 PM
## 8927 9430  7392617        1 05/08/2021 12:38:13 PM 05/08/2021 12:55:38 PM
## 9333 9866 29485133        1 12/15/2021 11:28:12 PM 12/15/2021 11:56:29 PM
##      passenger_count trip_distance RatecodeID store_and_fwd_flag PULocationID
## 6155               5          0.98          1                  N          237
## 10                 1          1.02          1                  N          140
## 3649               0          1.20          1                  N          186
## 4464               2          4.68          1                  N          234
## 8927               1          1.80          1                  N          249
## 9333               1          6.40          1                  N           48
##      DOLocationID payment_type fare_amount extra mta_tax tip_amount
## 6155          163            1         6.0   0.0     0.5       0.93
## 10            263            1         5.0   0.5     0.5       1.76
## 3649          107            1         9.0   2.5     0.5       2.45
## 4464          238            1        16.5   0.0     0.5       2.00
## 8927            4            1        12.0   2.5     0.5       3.05
## 9333          181            1        23.5   3.0     0.5       5.45
##      tolls_amount improvement_surcharge total_amount congestion_surcharge
## 6155            0                   0.3        10.23                  2.5
## 10              0                   0.3        10.56                  2.5
## 3649            0                   0.3        14.75                  2.5
## 4464            0                   0.3        21.80                  2.5
## 8927            0                   0.3        18.35                  2.5
## 9333            0                   0.3        32.75                  2.5
##      tipped tip_percent tip high_fare              pickup             dropoff
## 6155      1   0.1550000   1         0 2021-06-15 08:44:23 2021-06-15 08:50:13
## 10        1   0.3520000   1         0 2021-12-22 01:38:45 2021-12-22 01:41:03
## 3649      1   0.2722222   1         0 2021-10-16 17:02:12 2021-10-16 17:14:05
## 4464      1   0.1212121   1         0 2021-06-26 19:39:15 2021-06-26 19:57:34
## 8927      1   0.2541667   1         0 2021-05-08 12:38:13 2021-05-08 12:55:38
## 9333      1   0.2319149   1         1 2021-12-15 23:28:12 2021-12-15 23:56:29
##       duration season pickup_borough dropoff_borough
## 6155  5.833333 summer      Manhattan       Manhattan
## 10    2.300000 winter      Manhattan       Manhattan
## 3649 11.883333 autumm      Manhattan       Manhattan
## 4464 18.316667 summer      Manhattan       Manhattan
## 8927 17.416667 spring      Manhattan       Manhattan
## 9333 28.283333 winter      Manhattan        Brooklyn</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="model-1.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># one thing to note- I struggled for a bit before realizing that I needed to make my tip column</span></span>
<span id="cb5-2"><a href="model-1.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># into a factor with 2 levels: 0 and 1!</span></span>
<span id="cb5-3"><a href="model-1.html#cb5-3" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">OneR</span>(<span class="fu">factor</span>(tip) <span class="sc">~</span> pickup_borough <span class="sc">+</span> dropoff_borough <span class="sc">+</span> passenger_count <span class="sc">+</span> high_fare, <span class="at">data =</span> train_dat)</span>
<span id="cb5-4"><a href="model-1.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<pre><code>## 
## Call:
## OneR.formula(formula = factor(tip) ~ pickup_borough + dropoff_borough + 
##     passenger_count + high_fare, data = train_dat)
## 
## Rules:
## If dropoff_borough = Bronx         then factor(tip) = 0
## If dropoff_borough = Brooklyn      then factor(tip) = 1
## If dropoff_borough = EWR           then factor(tip) = 1
## If dropoff_borough = Manhattan     then factor(tip) = 1
## If dropoff_borough = Queens        then factor(tip) = 1
## If dropoff_borough = Staten Island then factor(tip) = 0
## If dropoff_borough = unknown       then factor(tip) = 1
## 
## Accuracy:
## 5346 of 7568 instances classified correctly (70.64%)
## 
## Contingency table:
##            dropoff_borough
## factor(tip) Bronx Brooklyn  EWR Manhattan Queens Staten Island unknown  Sum
##         0    * 39      104    2      1915    152           * 2      31 2245
##         1      18    * 164 * 10    * 4926  * 159             0    * 46 5323
##         Sum    57      268   12      6841    311             2      77 7568
## ---
## Maximum in each column: &#39;*&#39;
## 
## Pearson&#39;s Chi-squared test:
## X-squared = 125.79, df = 6, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="model-1.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod)</span></code></pre></div>
<p><img src="finalproj_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="model-1.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">predict</span>(mod, train_dat) <span class="sc">==</span> train_dat<span class="sc">$</span>tip)</span></code></pre></div>
<pre><code>## [1] 0.7063953</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="model-1.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">predict</span>(mod, test_dat) <span class="sc">==</span> test_dat<span class="sc">$</span>tip)</span></code></pre></div>
<pre><code>## [1] 0.7311146</code></pre>
<p>Interestingly, I have an accuracy of 66% for the training data, and an even higher accuracy of 66.7% for the test data. Compared to an overall frequency of 64.8% for tipped &gt; 15%, this doesn’t seem like that much of an information gain and the test accuracy being higher is a little odd.</p>
<p>Something interesting came up with the OneR function as I was running this. I noticed that for the Brooklyn column, OneR classified it as 1 when from my explorations, I knew that Brooklyn should have been classified as 0 since there were more instances of 0 than 1 in the data.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="model-1.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train_dat, <span class="fu">aes</span>(<span class="fu">fct_infreq</span>(dropoff_borough), <span class="at">fill =</span> <span class="fu">factor</span>(tip))) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="co"># contains rows with NAs</span></span></code></pre></div>
<p><img src="finalproj_files/figure-html/unnamed-chunk-6-1.png" width="672" />
As we can see, the relative frequencies for Brooklyn were 88 for 0 and 86 for 1, which means that OneR should have classified Brooklyn as 0 instead of 1 as it did in the model. However, OneR said there were 60 instances of 0 and 76 instances of 1 in the data. Why were some of the data points missing?</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="model-1.html#cb13-1" aria-hidden="true" tabindex="-1"></a>train_dat[<span class="fu">complete.cases</span>(train_dat),] <span class="sc">|&gt;</span> <span class="fu">group_by</span>(dropoff_borough, <span class="fu">factor</span>(tip)) <span class="sc">|&gt;</span> <span class="fu">count</span>() <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(dropoff_borough, <span class="sc">-</span>n), n, <span class="at">fill =</span> <span class="st">`</span><span class="at">factor(tip)</span><span class="st">`</span>)) <span class="sc">+</span> <span class="fu">geom_col</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="finalproj_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Now that we’ve removed all the rows with NA, we see the same results that OneR showed in the summary. It turns out this was all because the OneR function has been tossing any rows with NAs in it. This was good to know, and maybe this should have been more clear in the documentation!</p>
<p>Based on the OneR analysis, it seems that dropoff borough is the most important in determining whether or not a rider will tip over 15% on their ride, and it categorizes at 66.7% accuracy. However, we already know that 65% of all rides are classified as over 15% tip so we’re not sure how much information we’re gaining. As we can see from the plot, there are 5 categories (Bronx, Brooklyn, Manhattan, Queens, and unknown borough). Riders who are picked up in Manhattan have the highest rate of tipping over 15%, and riders who are picked up from the Bronx have the lowest rate of tipping over 15%. This made sense intuitively when I looked up the median household income for the different boroughs after making this plot. Highest to lowest median income goes Manhattan, Staten Island, Queens, Brooklyn, then Bronx which is the same order for tipping &gt;15% in this plot.</p>
<p>For each borough, it’s showing the relative frequencies which shows that Manhattan has the most rides. It also shows very few data points for EWR, Bronx, and unknown. It’s possible that those with fewer points would be skewed towards more 0’s than 1’s so that’s something to keep in mind.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="model-1.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># testing</span></span>
<span id="cb14-2"><a href="model-1.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb14-3"><a href="model-1.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb14-4"><a href="model-1.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="model-1.html#cb14-5" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">rpart</span>(tip <span class="sc">~</span> pickup_borough <span class="sc">+</span> dropoff_borough <span class="sc">+</span> season <span class="sc">+</span> high_fare, <span class="at">data =</span> train_dat, </span>
<span id="cb14-6"><a href="model-1.html#cb14-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">method=</span><span class="st">&quot;class&quot;</span>, </span>
<span id="cb14-7"><a href="model-1.html#cb14-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">control=</span><span class="fu">rpart.control</span>(<span class="at">cp=</span><span class="dv">0</span>))</span>
<span id="cb14-8"><a href="model-1.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(mod1, <span class="at">main =</span> <span class="st">&quot;tip&quot;</span>, <span class="at">under=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="finalproj_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="sources.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vliu5163/final-project-2023/edit/main/model1.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/vliu5163/final-project-2023/blob/main/model1.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
